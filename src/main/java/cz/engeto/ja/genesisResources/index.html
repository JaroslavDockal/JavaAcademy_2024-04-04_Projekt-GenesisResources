<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple User Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        form {
            margin-bottom: 20px;
        }
        .user-list {
            list-style-type: none;
            padding: 0;
        }
        .user-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 5px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<h1>Genesis Resources User Management</h1>
<h3>Not much, but it's post-apocalyptic word -> good enough...</h3>
<form id="userForm">
    <h2>Create User</h2>
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>
    <br>
    <label for="surname">Surname:</label>
    <input type="text" id="surname" name="surname" required>
    <br>
    <label for="personID">Person ID:</label>
    <input type="text" id="personID" name="personID" required minlength="12" maxlength="12">
    <br>
    <button type="submit">Create User</button>
</form>

<h2>Fetch User(s)</h2>
<label for="fetchType">Select Fetch Type:</label>
<select id="fetchType" name="fetchType">
    <option value="all">All Users</option>
    <option value="id">User by ID</option>
    <option value="uuid">User by UUID</option>
</select>
<br>
<div id="inputID" class="hidden">
    <label for="userId">User ID:</label>
    <input type="number" id="userId" name="userId">
</div>
<div id="inputUUID" class="hidden">
    <label for="userUUID">User UUID:</label>
    <input type="text" id="userUUID" name="userUUID">
</div>
<label for="detail">Include Details:</label>
<input type="checkbox" id="detail" name="detail">
<br>
<button id="fetchButton">Fetch</button>

<h2>User List</h2>
<ul id="userList" class="user-list"></ul>

<script>
    const apiUrl = 'http://localhost:8080/api/v1/users';

    document.getElementById('fetchType').addEventListener('change', function() {
        const fetchType = this.value;
        document.getElementById('inputID').classList.add('hidden');
        document.getElementById('inputUUID').classList.add('hidden');
        if (fetchType === 'id') {
            document.getElementById('inputID').classList.remove('hidden');
        } else if (fetchType === 'uuid') {
            document.getElementById('inputUUID').classList.remove('hidden');
        }
    });

    async function fetchAndDisplayUsers(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('Failed to fetch users');
            }
            const data = await response.json();
            console.log('Fetched data:', data);
            const userList = document.getElementById('userList');
            userList.innerHTML = ''; // Clear previous list items
            if (Array.isArray(data)) {
                data.forEach(user => {
                    const userItem = document.createElement('li');
                    userItem.classList.add('user-item');
                    userItem.textContent = `ID: ${user.id} - ${user.name} ${user.surname} (personID: ${user.personID}, UUID: ${user.uuid})`;
                    userList.appendChild(userItem);
                });
            } else {
                const userItem = document.createElement('li');
                userItem.classList.add('user-item');
                userItem.textContent = `${data.name} ${data.surname} (ID: ${data.id})`;
                userList.appendChild(userItem);
            }
        } catch (error) {
            console.error('Error fetching users:', error);
        }
    }

    document.getElementById('fetchButton').addEventListener('click', function(event) {
        event.preventDefault();
        const fetchType = document.getElementById('fetchType').value;
        const detail = document.getElementById('detail').checked;
        let url = apiUrl;
        if (fetchType === 'all') {
            url += detail ? '?detail=true' : '';
        } else if (fetchType === 'id') {
            const userId = document.getElementById('userId').value;
            url += `/${userId}${detail ? '?detail=true' : ''}`;
        } else if (fetchType === 'uuid') {
            const userUUID = document.getElementById('userUUID').value;
            url += `/uuid/${userUUID}${detail ? '?detail=true' : ''}`;
        }
        console.log('Fetching URL:', url);
        fetchAndDisplayUsers(url);
    });

    document.getElementById('userForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const formData = new FormData(this);
        const user = {
            name: formData.get('name'),
            surname: formData.get('surname'),
            personID: formData.get('personID')
        };
        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(user)
            });
            if (!response.ok) {
                throw new Error('Failed to create user');
            }
            this.reset();
            fetchAndDisplayUsers(apiUrl);
        } catch (error) {
            console.error('Error creating user:', error);
        }
    });

    fetchAndDisplayUsers(apiUrl);
</script>
</body>
</html>
